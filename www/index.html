<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Capacitor Demo</title>
    <script src="capacitor.js"></script>
    <style>
        body { font-family: sans-serif; display: flex; flex-direction: column; align-items: center; padding: 20px; gap: 15px; text-align: center; }
        button { font-size: 1.2em; padding: 15px 25px; cursor: pointer; border-radius: 8px; border: 1px solid #ccc; background-color: #f0f0f0; }
        #status { font-weight: bold; color: green; min-height: 40px; }
        .error { color: red; }
    </style>
</head>
<body>
    <h1>Capacitor Features Demo</h1>
    <p id="status">Press a button to test a feature.</p>

    <button id="backupBtn">1. Backup Dummy Data</button>
    <button id="shareTextBtn">2. Share Text</button>
    <button id="shareImageBtn">3. Share Dummy Image</button>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const backupBtn = document.getElementById('backupBtn');
            const shareTextBtn = document.getElementById('shareTextBtn');
            const shareImageBtn = document.getElementById('shareImageBtn');
            const statusEl = document.getElementById('status');
            
            // Permissions check function
            const checkPermissions = async () => {
                try {
                    const { Filesystem } = Capacitor.Plugins;
                    let permStatus = await Filesystem.checkPermissions();
                    if (permStatus.publicStorage !== 'granted') {
                        statusEl.textContent = 'Requesting storage permission...';
                        permStatus = await Filesystem.requestPermissions();
                    }
                    return permStatus.publicStorage === 'granted';
                } catch(e) {
                    console.error("Permission API not available. Assuming web.");
                    return true;
                }
            };

            // 1. Backup Button
            backupBtn.addEventListener('click', async () => {
                statusEl.className = '';
                statusEl.textContent = 'Backup button clicked, checking permissions...';
                
                const hasPermission = await checkPermissions();
                if (!hasPermission) {
                    statusEl.className = 'error';
                    statusEl.textContent = 'Error: Storage permission denied.';
                    return;
                }

                try {
                    const { Filesystem } = Capacitor.Plugins; // Ab Directory aur Encoding yahan se nahi lenge
                    const dummyData = { student: "Ali", sabaq: "Para 1" };
                    const fileName = `dummy_backup_${Date.now()}.json`;
                    
                    statusEl.textContent = 'Permission granted. Writing file...';

                    await Filesystem.writeFile({
                        path: fileName,
                        data: JSON.stringify(dummyData, null, 2),
                        // THE FIX IS HERE: Use raw strings instead of enums
                        directory: "DOWNLOADS", 
                        encoding: "UTF-8",
                        recursive: true
                    });

                    statusEl.textContent = `Success! Backup saved to Downloads folder as ${fileName}`;
                } catch (e) {
                    statusEl.className = 'error';
                    statusEl.textContent = 'Backup Error: ' + e.message;
                    console.error(e);
                }
            });

            // 2. Share Text Button
            shareTextBtn.addEventListener('click', async () => {
                statusEl.className = '';
                statusEl.textContent = 'Share text button clicked...';
                try {
                    const { Share } = Capacitor.Plugins;
                    await Share.share({
                        title: 'Test Share',
                        text: 'This is a test message from a working Capacitor app!',
                        dialogTitle: 'Share this text',
                    });
                    statusEl.textContent = 'Share dialog opened successfully!';
                } catch(e) {
                    statusEl.className = 'error';
                    statusEl.textContent = 'Share Text Error: ' + e.message;
                    console.error(e);
                }
            });

            // 3. Share Image Button
            shareImageBtn.addEventListener('click', async () => {
                statusEl.className = '';
                statusEl.textContent = 'Share image button clicked...';

                try {
                    const { Filesystem, Share } = Capacitor.Plugins;
                    const dummyBase64Image = 'iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg==';
                    const fileName = 'dummy_image.png';

                    statusEl.textContent = 'Writing temporary image file...';
                    
                    const result = await Filesystem.writeFile({
                        path: fileName,
                        data: dummyBase64Image,
                        // THE FIX IS HERE: Use raw strings instead of enums
                        directory: "DATA", 
                    });

                    statusEl.textContent = 'File written. Opening share dialog...';

                    await Share.share({
                        title: 'Dummy Image',
                        url: result.uri,
                        dialogTitle: 'Share this image',
                    });
                    statusEl.textContent = 'Share dialog for image opened successfully!';
                } catch(e) {
                    statusEl.className = 'error';
                    statusEl.textContent = 'Share Image Error: ' + e.message;
                    console.error(e);
                }
            });

        });
    </script>
</body>
</html>
